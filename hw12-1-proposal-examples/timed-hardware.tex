%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}


%% Journal information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{PLDI} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2019}
\acmMonth{10}
%\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format must update the '\documentclass' and
%% topmatter commands above; see 'acmart-sigplanproc-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption


\usepackage{minted}



\begin{document}

%% Title information
\title[Timed]{Timed Hardware Computation}         %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
\subtitle{Proposal}                     %% \subtitle is optional
%%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{Matthew Ahrens}
%\authornote{with author1 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
%\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Graduate Student}
  \department{Computer Science}              %% \department is recommended
  \institution{Tufts University}            %% \institution is required
  \streetaddress{161 College Ave}
  \city{Medford}
  \state{Ma}
  \postcode{02189}
  \country{USA}                    %% \country is recommended
}
\email{matthew.ahrens@tufts.edu}          %% \email is recommended

%% Author with two affiliations and emails.
%\author{First2 Last2}
%\authornote{with author2 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
%\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
%\affiliation{
%  \position{Position2a}
%  \department{Department2a}             %% \department is recommended
%  \institution{Institution2a}           %% \institution is required
%  \streetaddress{Street2a Address2a}
%  \city{City2a}
%  \state{State2a}
%  \postcode{Post-Code2a}
%  \country{Country2a}                   %% \country is recommended
%}
%\email{first2.last2@inst2a.com}         %% \email is recommended
%\affiliation{
%  \position{Position2b}
%  \department{Department2b}             %% \department is recommended
%  \institution{Institution2b}           %% \institution is required
%  \streetaddress{Street3b Address2b}
%  \city{City2b}
%  \state{State2b}
%  \postcode{Post-Code2b}
%  \country{Country2b}                   %% \country is recommended
%}
%\email{first2.last2@inst2b.org}         %% \email is recommended


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
%\begin{abstract}
%Text of abstract \ldots.
%\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
%\begin{CCSXML}
%<ccs2012>
%<concept>
%<concept_id>10011007.10011006.10011008</concept_id>
%<concept_desc>Software and its engineering~General programming languages</concept_desc>
%<concept_significance>500</concept_significance>
%</concept>
%<concept>
%<concept_id>10003456.10003457.10003521.10003525</concept_id>
%<concept_desc>Social and professional topics~History of programming languages</concept_desc>
%<concept_significance>300</concept_significance>
%</concept>
%</ccs2012>
%\end{CCSXML}

% \ccsdesc[500]{Software and its engineering~General programming languages}
% \ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
\keywords{DSL,Embedded Systems}  %% \keywords are mandatory in final camera-ready submission


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

\paragraph{The domain}
Two imperative functions define many small hardware programs: a setup and a loop body.
Consider the example program in figure \ref{prog1}. 
On a device that supports a hardware interface such as GPIO (General Purpose Input Output), this program initializes pins and allocates memory during setup, and it reads data from hardware input, performs data transformations, and writes data to hardware output during the loop body.
\paragraph{The current practice}
These hardware inputs and outputs often have timing constraints. 
A timing constraint could look like a specified rate on input to avoid appearing laggy, a specified rate on output to avoid burning out hardware actuators, or restricting intermediate computation to avoid both dropping data and redundantly consuming data. 
The example program in figure \ref{prog2} shows what a programmer would write to satisfiy timing constrains where an input needs to run every 500 milliseconds and an output needs to run every 2500 milliseconds.
\paragraph{The problem}
In the last example program, the constraint on the output can only be seen indirectly from the constraint on the input and the implementation of the loop -- e.g. 5 * 500. The constraint of 2500 milliseconds itself does not manifest in the program.
Also, this magic number 5 appears in both the control flow and memory allocation; where did this magic number come from? 
The programmers solved for it given the constraints on the hardware input and output. 
If the programmers did this calculation wrong, the hardware might not run at the expected rate, and the data in the buffer might be read from redundantly or overwritten without ever being read. 
For simple programs, solving these constraints appears trivial, but complexity grows as programs contain data dependencies that are not 1-1. For example, data from multiple inputs could be transformed together to control an output.
\paragraph{Solution}
A DSL could assist writing these imperative programs. 
Given information about how often hardware should run, the DSL performs a static analysis at compile time to ensure that the delays in the program respect the specified rates.
To enable this analysis, the programmers must express computation in terms of constant iterations, like the magic number 5, and not variable or dynamic control flow. 
The DSL will not handle variable nor dynamic rate constraints.
In exchange, the DSL will solve for delay and loop constraints for users if they leave "holes" in the program for the compiler to fill in.
Lastly, at runtime, the DSL will instrument the programs with special delays that track timing errors in the case runtime code
does not allow for the timing constraints the user expects. For example, if a transformation function takes a long time to compute a result, that time will impact how often hardware runs. 
If the time the transformation function takes is less than the delay statements, however, the program could subtract the time spent from the amount to delay at runtime thus not breaking the constraint.
%% Acknowledgments
%\begin{acks}                            %% acks environment is optional
                                        %% contents suppressed with 'anonymous'
  %% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
  %% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
  %% acknowledge financial support and will be used by metadata
  %% extraction tools.
  %This material is based upon work supported by the
  %\grantsponsor{GS100000001}{National Science
  %  Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
  %No.~\grantnum{GS100000001}{nnnnnnn} and Grant
  %No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
  %conclusions or recommendations expressed in this material are those
  %of the author and do not necessarily reflect the views of the
  %National Science Foundation.
%\end{acks}


%% Bibliography
%\bibliography{bibfile}

\pagebreak

%% Appendix
%\appendix
%\section{Appendix}
\begin{figure}
\begin{minted}{c}
  int inputPin = 1;
  int outputPin = 2;
  
  void setup(){
    pinMode(inputPin, READ);
    pinMode(outputPin, WRITE);
  }
  
  void loop(){
    int value = read(inputPin);
    write(outputPin);
    delay 500; //milliseconds
  }
\end{minted}
	\caption{\label{prog1} An imperative C-like setup-loop program that illustrates how programmers program small hardware devices with input, output, and delay primtives.}
\end{figure}

\begin{figure}
  \begin{minted}{c}
    int inputPin = 1;
    int outputPin = 2;
    
    int dataBuffer[5]  	  
    void setup() {
      pinMode(inputPin, READ);
      pinMode(outputPin, WRITE);
    }
    
    void loop(){
      for(int i = 0; i < 5; i++) {
        dataBuffer[i] = read(inputPin);
	delay 500; //milliseconds
      }
      write(outputPin, transform(dataBuffer));
    }

    int * transform(int[5] buttonPresses); //some transformation function
  \end{minted}
	\caption{\label{prog2} This program shows that, even for a simple 1-input-1-output scenario, the programmer must solve for magic numbers -- e.g. 5 -- to implement timing constraints (input: 500ms, output: 2500 ms), and the magic number appears in multiple places (control flow, memory allocation) in the program.}
\end{figure}


\end{document}
